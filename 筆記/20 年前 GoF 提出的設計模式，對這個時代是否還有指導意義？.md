# 20 年前 GoF 提出的設計模式，對這個時代是否還有指導意義？

在四人幫（Gang of Four, GoF）的那本設計模式的書出版 20 年後，重新審視設計模式，書中的 23 種設計模式，真的只是 23 種使用指針的方法嗎？對我們這個時代是否還有指導意義？（來自灣區日報對本文的評論）

二十年前，軟件設計領域的四位大師（GoF，「四人幫」，又稱 Gang of Four ，即 Erich Gamma, Richard Helm, Ralph Johnson & John Vissides ）通過論著《設計模式：可複用面向對象軟件的基礎》 闡述了設計模式領域的開創性成果。

當時軟件設計仍以 C++ 與 Smalltalk 為主流，同時利用時間設計理念（例如強調繼承(WSJ)）進行編寫，但拋開歷史的局限，他們已經為業界帶來一場規模可觀的浪潮。然而歷史告訴我們，任何言過其實且無法在實踐層面覆行承諾的「浪潮」都必然令人失望，並最終遭到淘汰。如今二十年彈指一揮，我們應當重新審視當初提出的 23 種模式（其中一些亦可被稱為變種），考慮它們與二十年來愈發成熟的編程語言還能否契合或者說並發出新的火花。

![](C:\Users\chobits\Desktop\learn\心得\0005.jpg)

## 模式：究竟有著怎樣的作用？

在模式「運動」發展之初，人們還將其視為一種新鮮的概念，但卻很少花時間探討其究竟是什麼。模式就是模式--它來自我們閱讀的參考書籍、體現在實踐層面的代碼當中，亦充斥於我們的日常工作之內。直觀地講，我們似乎意識到自己能夠運用這些知識，亦欣賞頭腦中孕育出的種種新型模式思路。

Gang of Four （簡稱GoF）似乎從一開始就將模式視為一種藝術 / 科學；在論著的最後一章（遺憾(HKH)的是，讀者們大多直接將其忽略），他們指出：

> 這本書的實際價值也許還值得商榷。畢竟它並沒有提出任何前所未有的算法或者編程技術。它也沒能給出任何嚴格的系統設計方法或者新的設計開發理論--它只是對現有設計成果的一種審視。大家當然可以將其視為一套不錯的教程，但它顯然無法為經驗豐富的面向對象設計人員帶來多少幫助。

但需要強調的是，實際情況在於：這本書中的模式設計理念尚未徹底完成。我在 DevelopMentor 上結識的一位朋友將設計模式稱為「23 種指針使用方法」。好吧，似乎也有道理。

同樣的，當管理層/高管團隊將這本書甩給新手開發者並希望他們通過閱讀實現技能「升級」時，結果也肯定會讓他們深感失望。

然而，收益仍是真實存在的，而且更加微妙：

> 我們希望您能擁有差異化思維。對設計模式進行分類非常重要，這意味著我們能夠在相關技術當中使用標準名稱與定義。如果不對軟件中的設計模式進行學習，那麼我們將無法對其加以改進，更遑論創造出更多新模式。

誠然， GoF 的這本論著引發了一股浪潮，而這股模式浪潮又催生出遠超 GoF 提出的 23 種初始模式之外的思維結晶。然而，事情亦開始朝著更為抽象及高層的方向推進，模式開始以「模式語言」的姿態出現，並反過來創造出「元模式」。而後人們開始記錄其中的負面因素，並將其稱為「反模式」。

一但人們意識到這一議題能夠帶來經濟收益，相關出垿物亦開始不斷涌現。

各類出版商不斷推出「模式」方面的書籍--但這些出版物幾乎根本不涉及 GoF 提出的原始模型。模式書籍成了「可複用代碼」（而非「可複用設計元素」）的代名詞。IDE 供應商開始尋找可行途徑，希望將多種模式整合為代碼生成器。同樣莫名其妙的是，模式也開始成為 UML 及其它設計符號的載體，其目標被誤解成弄清如何在 UML 當中找到與模式相對應的可複用設計模板。

與眾多炒作對象一樣，模式成為一種潮流，但人們並不知道其核心吸引力究竟是什麼。在這種情況下，模式概念顯然沒辦法滿足人們的預期。

到 2000 年中葉，模式開始成為一種負面概念，當時的宣傳導向則轉為「搗毀」模式--即強調模式屬於「糟糕語言」加「原始思路」再加上「被歸入優秀語言」的綜合體。

**換言之，模式顯然毫無實際用處。**

但是……模式這一稱謂仍然不斷出現，直到今天我們亦在大量使用。為什麼？ GoF 實際早在 1995 年就對此做出了預言（同樣來自書中最後一章）：

> 「設計模式為設計師們提供一種共通的詞滙儲備，幫助其溝(WJE)通、編寫文檔並探索設計方案。設計模式允許我們立足於高級抽象層面進行探討，而非設計標注或者編程語言，這就大大降低了系統複雜性。設計模式提升了我們設計及與同事進行設計探討時的切入點層級。」（第 289 頁）


> 「理解本書中的設計模式能夠幫助大家更輕松地掌握現有系統。……人們在學習面向對象編程時，往往會對需要面對的系統抱怨不休，包括其要求以令人費解的方式實現繼承且難以追蹤並控制工作流。之所以出現這些問題，很大程度是因為他們並不了解系統的設計模式。了解這些設計模式能夠幫助各位更好地掌控現有面向對象系統。」（第 389 頁）


> 「設計模式提供了一種既能解釋決策結果，又能解釋設計『理由』的方式。設計模式的適用性、結果性與實現部分能夠引導大家做出更為明智的決策。」


> 「在開發可利用軟件時，一大問題在於其往往必須進行重構或者重組[OJ90]。設計模式能幫助大家了解如何對設計進行重組，並降低日後需要面對的重構工作量。」

（是的，他們早在業界將其視為時尚之前，就已經提出了重構的必要性。）

最重要的是，他們還準確預測出了模式弊端所引發的問題：

> 「人們很容易將模式視為一種解決方案，或者說一種能夠進行實際采納及複用的技術。相比之下，人們很難弄清其更為確切的核心--即定義其能夠解決的問題以及在哪些背景下才屬於最佳解決方案。總體來講，大多數人都能弄清他人正在做什麼，卻不太了解這樣做的理由--而所謂『理由』對於模式而言正是其需要解決的主要問題。理解模式的目標同樣重要，因為這能幫助我們選定適合自己的模式，也能幫助我們理解現有系統的設計方式。模式作者必須弄清並定義該模式所能解決的問題，或者至少在將其作為解決方案之後做出進一步思考。」（第 393 頁）

很多短視的從業者將模式視為「解決方案」，並一窩蜂地希望找到可複用代碼，但卻忘了（或者刻意不去想）『理由』是什麼。作為結果，他們往往會犯下一些非常愚蠢--但本該能夠輕易被預測--的錯誤。

## 模式是什麼？

多年以來，圍繞這一議題出現了無數討論，但我想用下面這句話對其加以概括：

**模式是一套立足於特定背景，且擁有一整套可預測結果的解決方案。**

就是這樣。沒什麼神秘或者超學術性質的元素。如果大家能夠對元組的全部四個部分加以描述，那麼這就是一種模式。把它寫下來再加以發布。

一但發現了彼此之間的共同點，我們就可以從中找到共性所在，而後為其選定一個合適的名稱並加入到通用詞匯表當中。

Gang of Four 發布了 23 條這樣的模式，當然模式的實際數量遠不止如此。大部分模式都極具實用性，但實用性最出眾的還是這初的 23 條--因為它們涵蓋了眾多不同類型的編程語言。（模式業界後來創造出了所謂「成語」，其只適用於特定的語言。因此來自 C++ 的『資源獲取即初始化（簡稱 RAII ）』概念就成了與 C++ 語言緊密相關的『成語』，而並非真正的模式。）

## 我們為什麼要進行討論？

不過最後一句又帶來新的問題：模式業界投入了太多時間進要討論，包括模式本身、特定對象是否屬於模式乃至某種特定代碼片段到底屬於哪種模式的具體實現方式等等。

在這方面我們有兩種基本思路：

* 圍繞模式展開的哲學辯論對切實實現其收益而言非常重要。正因為如此，模式業界才會提出「某種對象至少要出現三次才能被稱為模式」以及「未曾出現在模式會議上的成果根本不能被稱為模式」等論調。其重點並不是為模式添加神秘色彩或者不可知論要素，而是探討如何從哲學層面定義模式的實質並保證其質量水平。一但人們對這種作法嗤之以鼻並加以回避，那麼可以想見，一切疑似模式的事物都將使粗暴(DW)地視為模式。如果突然之間，我們開始將本地變量稱為「模式」，那麼設計高級工具集的意義將不複存在。如果任何人都能夠根據自己的理解將任意對象稱為「模式」，那麼模式也就失去了其在交流中的作用。科學具有嚴謹性，而嚴謹性正是模式業界最為需要的特質。
* 實際使用哪種模式並不重要，或者說只是一種哲學層面的討論。很多人都喜歡跟團隊中的其他成員爭論某些代碼到底屬於哪種模式。我實在想不到還有比這更無聊的行為了--除非這類討論能夠圍繞模式帶來什麼新啟發（例如新的應用方式或者新的審視角度）。總之，這種作法甚至會影響到人與人之間的友好關系。
* 模式並不是優秀設計的全部或者必要標準。大家完全可以鼓搗出一套出色但卻完全不符合任何現有模式的設計方案。模式的擁護者們，請不要再拉著這面大旗對身邊的一切品評不休了。

最後需要強調的是，模式的擁護者本身可能正是導致模式毀滅的導火索--但事情仍然還有轉機。

## 撥亂反正

我想在模式概念首次出現的二十年後，是時候對其進行重新討論了。我無法想象自己如何憑一己之力重現這樣的浪潮，但至少我可以對過往的積累加以整理，留精華而去其糟粕，並期待將其引入二十一世紀大家所熟悉的各類主流語言。在這一過程中，也許我們還會發現更多新的模式，我亦會從中選擇部分合適的與大家分享。

在未來幾個月中，我將立足於「現代世界」對這 23 條元祖模式進行回顧，並采取我個人最喜愛的審視方式（問題/解決方案/背景/結果）。我不會直接引用太多來自 Gang of Four 論著中的原文，因為這會構成侵權行為--但我強烈建議大家買一本自行閱讀，並借此思考我給出的結論是否合理。另外，我還會以部分現代語言為基礎探討各類模式的實現方式，具體包括： C++、 C# 、 Java 、 Swift 、 F# 、 Scala 以及 JavaScript 等等。我絕對不是世界上最聰明的家伙，所以肯定沒法以最為純亦的方式運用這些語言並探討其相關成語適用性--因此請大家積極發表意見與建議，以幫助我完成修改/更正。另外，我也希望能夠與大家共同涵蓋全部主流（可能也會包含部分並不那麼流行但有助於指導效果的語言）語言。

這些工作都需要時間，所以請大家多包涵。我會盡快再發布一篇博文討論具體細節，而在此期間希望大家能買一本 GOF 的《設計模式：可複用面向對象軟件的基礎》來讀讀。

## 後記

作者做的工作非常有意思，在我和他發郵件申請本文的版權的同時，他也誠摯的邀請中國的開發者能和他做這個有意思的探索。的確，設計模式已經存在了幾十年，很多東西已經不再適用，但這些模式已經被當做開發領域的金玉良言。是時候來反思了！

點擊閱讀原文縺接，查看作者對 Java 的單例模式的論述，如果感興趣，歡迎評論留言，和 Ted 一起回顧設計模式。

本文經 Ted 授權翻譯，原文地址：http://www.infoq.com/cn/articles/design-patterns-proposed-by-gof-20-years-ago

